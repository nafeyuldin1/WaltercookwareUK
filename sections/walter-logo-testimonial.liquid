{% schema %}
{
  "name": "Logo Testimonials",
  "settings": [
    {
      "type": "header",
      "content": "Color Settings"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#03231A"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ded2bc"
    },
    {
      "type": "header",
      "content": "Section Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 2,
      "unit": "px",
      "label": "Padding Top (Desktop)",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom (Desktop)",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_top_m",
      "min": 0,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Padding Top (Mobile)",
      "default": 64
    },
    {
      "type": "range",
      "id": "padding_bottom_m",
      "min": 0,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom (Mobile)",
      "default": 64
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Logo & Quote",
      "settings": [
        {
          "type": "image_picker",
          "id": "image_desktop",
          "label": "Logo Image (Desktop)"
        },
        {
          "type": "image_picker",
          "id": "image_mobile",
          "label": "Logo Image (Mobile)",
          "info": "Optional. Will use Desktop image if blank."
        },
        {
          "type": "range",
          "id": "logo_width",
          "min": 50,
          "max": 250,
          "step": 2,
          "unit": "px",
          "label": "Logo Max Width (Desktop)",
          "default": 120
        },
        {
          "type": "range",
          "id": "logo_width_mobile",
          "min": 40,
          "max": 150,
          "step": 2,
          "unit": "px",
          "label": "Logo Max Width (Mobile)",
          "default": 80
        },
        {
          "type": "richtext",
          "id": "quote",
          "label": "Quote Text",
          "default": "<p>Add your customer testimonial or press quote here.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Logo Testimonials",
      "blocks": [
        {
          "type": "testimonial"
        },
        {
          "type": "testimonial"
        },
        {
          "type": "testimonial"
        }
      ]
    }
  ]
}
{% endschema %}

<div id="section-{{ section.id }}" class="logo-testimonials-section">
  <div class="logo-testimonials">
    
    <div class="logo-container">
      {% for block in section.blocks %}
        {% if block.settings.image_desktop != blank %}
          
          {% assign desktop_width = block.settings.logo_width %}
          {% assign mobile_width = block.settings.logo_width_mobile %}
          
          <img 
            src="{{ block.settings.image_desktop | image_url: width: 400 }}" 
            class="logo-image logo-image-desktop"
            loading="lazy"
            width="{{ desktop_width }}"
            height="auto"
            data-index="{{ forloop.index0 }}"
            alt="{{ block.settings.image_desktop.alt | escape }}"
            style="--desktop-width: {{ desktop_width }}px;"
          >

          {% assign mobile_img = block.settings.image_mobile | default: block.settings.image_desktop %}
          
          <img 
            src="{{ mobile_img | image_url: width: 300 }}" 
            class="logo-image logo-image-mobile"
            loading="lazy"
            width="{{ mobile_width }}"
            height="auto"
            data-index="{{ forloop.index0 }}"
            alt="{{ mobile_img.alt | escape }}"
            style="--mobile-width: {{ mobile_width }}px;"
          >

        {% endif %}
      {% endfor %}
    </div>

    <div class="quote-display">
      {% for block in section.blocks %}
        <div class="logo-quote {% unless forloop.first %}hidden{% endunless %}" data-index="{{ forloop.index0 }}">
          {{ block.settings.quote }}
        </div>
      {% endfor %}
    </div>

  </div>
</div>

{% style %}
  #section-{{ section.id }} .logo-testimonials {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    flex-wrap: nowrap;
    gap: 6vw;
    background-color: {{ section.settings.bg_color }};
    color: {{ section.settings.text_color }};
    text-align: left;
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    padding-left: clamp(40px, 6vw, 120px);
    padding-right: clamp(40px, 6vw, 120px);
  }

  #section-{{ section.id }} .logo-container,
  #section-{{ section.id }} .quote-display {
    flex: 1;
    min-width: 0;
  }

  #section-{{ section.id }} .logo-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
    row-gap: 50px;
  }

  /* Logo Images Styling */
  #section-{{ section.id }} .logo-image {
    width: auto;
    cursor: pointer;
    opacity: 1;
    transition: opacity 0.3s;
    height: auto;
    object-fit: contain;
  }

  #section-{{ section.id }} .logo-image-desktop {
    max-width: var(--desktop-width); /* Controlled by CSS Variable from Liquid */
  }
  
  #section-{{ section.id }} .logo-image-mobile {
    max-width: var(--mobile-width); /* Controlled by CSS Variable from Liquid */
    display: none;
  }

  /* Initial State: Fade all except the first one (handled by JS, but default logic here) */
  #section-{{ section.id }} .logo-image:not([data-index="0"]) {
    opacity: 0.2;
  }

  #section-{{ section.id }} .logo-image.faded {
    opacity: 0.2;
  }
  
  #section-{{ section.id }} .logo-image.active-logo {
    opacity: 1 !important;
  }

  #section-{{ section.id }} .quote-display {
    max-width: 731px;
  }

  #section-{{ section.id }} .logo-quote h3,
  #section-{{ section.id }} .logo-quote p {
    font-family: 'Neue Montreal', sans-serif; /* Ensure this font is loaded in theme or change */
    font-weight: 400;
    font-size: clamp(20px, 2.2vw, 32px);
    line-height: 1.3;
    letter-spacing: 0.04em;
    text-transform: capitalize;
    margin: 0;
    color: {{ section.settings.text_color }};
  }

  #section-{{ section.id }} .hidden {
    display: none;
  }

  /* Responsive Logic */
  @media (max-width: 1100px) {
    #section-{{ section.id }} .logo-testimonials {
      flex-direction: column;
      text-align: center;
      padding-top: {{ section.settings.padding_top_m }}px;
      padding-bottom: {{ section.settings.padding_bottom_m }}px;
      padding-left: 16px;
      padding-right: 16px;
    }

    #section-{{ section.id }} .logo-container {
      margin-bottom: 40px;
      justify-content: space-between;
    }

    #section-{{ section.id }} .quote-display {
      max-width: 100%;
    }
  }

  @media (max-width: 750px) {
    #section-{{ section.id }} .logo-image-desktop {
      display: none;
    }
    #section-{{ section.id }} .logo-image-mobile {
      display: block;
    }
    #section-{{ section.id }} .logo-container {
      justify-content: space-between;
      width: 100%;
    }
  }
{% endstyle %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const sectionContainer = document.getElementById("section-{{ section.id }}");
    const logos = sectionContainer.querySelectorAll(".logo-image");
    const quotes = sectionContainer.querySelectorAll(".logo-quote");

    logos.forEach((logo) => {
      logo.addEventListener("click", () => {
        const index = logo.getAttribute("data-index");

        // Fade all logos
        logos.forEach((l) => {
          l.classList.add("faded");
          // Remove active state from all
          if(l.getAttribute("data-index") !== index) {
             l.style.opacity = '0.2';
          }
        });

        // Highlight clicked logo (handling both desktop and mobile versions of same index)
        const activeLogos = sectionContainer.querySelectorAll(`.logo-image[data-index="${index}"]`);
        activeLogos.forEach(l => {
            l.classList.remove("faded");
            l.style.opacity = '1';
        });

        // Show corresponding quote
        quotes.forEach((q) => {
          q.classList.add("hidden");
          if (q.getAttribute("data-index") === index) {
            q.classList.remove("hidden");
          }
        });
      });
    });
  });
</script>