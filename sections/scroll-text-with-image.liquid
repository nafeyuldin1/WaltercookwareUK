{% schema %}
{
  "name": "Scroll Text with Image",
  "settings": [
    {
      "type": "header",
      "content": "Section Colors"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#00221c"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color (Unfocused)",
      "default": "#BCA588"
    },
    {
      "type": "color",
      "id": "focus_color",
      "label": "Text Color (Focused)",
      "default": "#ded2bc"
    },
    {
      "type": "header",
      "content": "Image Settings"
    },
    {
      "type": "image_picker",
      "id": "section_image",
      "label": "Section Image"
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "text",
      "id": "btn_label",
      "label": "Button Label",
      "default": "Make The Switch Today"
    },
    {
      "type": "url",
      "id": "btn_link",
      "label": "Button Link"
    },
    {
      "type": "color",
      "id": "btn_bg",
      "label": "Button Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "btn_text",
      "label": "Button Text Color",
      "default": "#121212"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 2,
      "unit": "px",
      "label": "Padding Top (Desktop)",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom (Desktop)",
      "default": 80
    }
  ],
  "blocks": [
    {
      "type": "text_line",
      "name": "Scroll Line",
      "settings": [
        {
          "type": "textarea",
          "id": "text",
          "label": "Text Line",
          "default": "Add your scrolling text here"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Scroll Text with Image",
      "blocks": [
        { "type": "text_line", "settings": { "text": "You only get one body." } },
        { "type": "text_line", "settings": { "text": "One life." } },
        { "type": "text_line", "settings": { "text": "Every decision you make is" } },
        { "type": "text_line", "settings": { "text": "either a step toward" } },
        { "type": "text_line", "settings": { "text": "honoring that gift," } },
        { "type": "text_line", "settings": { "text": "or throwing it away." } },
        { "type": "text_line", "settings": { "text": "Start with" } },
        { "type": "text_line", "settings": { "text": "what you use every day." } },
        { "type": "text_line", "settings": { "text": "Start with TaimaÂ®." } }
      ]
    }
  ]
}
{% endschema %}

<div id="section-{{ section.id }}" class="shopify-section scroll-image-text-section">
  <div class="scroll-image-text-container">
    
    <div class="scroll-image">
      {% if section.settings.section_image != blank %}
        {{ section.settings.section_image | image_url: width: 1000 | image_tag: 
          loading: 'lazy', 
          alt: section.settings.section_image.alt 
        }}
      {% else %}
        {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
      {% endif %}
    </div>

    <div class="scroll-text">
      {% for block in section.blocks %}
        {% if block.settings.text != blank %}
          <p class="scroll-line" data-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
            {{ block.settings.text }}
          </p>
        {% endif %}
      {% endfor %}

      {% if section.settings.btn_label != blank and section.settings.btn_link != blank %}
        <a href="{{ section.settings.btn_link }}" class="scroll-button">
          {{ section.settings.btn_label }}
        </a>
      {% endif %}
    </div>

  </div>
</div>

<style>
/* Section Variables based on Settings */
#section-{{ section.id }}.scroll-image-text-section {
  background-color: {{ section.settings.bg_color }};
  color: {{ section.settings.text_color }};
  padding-top: {{ section.settings.padding_top }}px;
  padding-bottom: {{ section.settings.padding_bottom }}px;
  padding-left: 80px;
  padding-right: 80px;
}

#section-{{ section.id }} .scroll-image-text-container {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 200px;
  justify-content: space-between;
}

/* Image Styles */
#section-{{ section.id }} .scroll-image {
  flex: 1;
}

#section-{{ section.id }} .scroll-image img,
#section-{{ section.id }} .scroll-image svg {
  max-width: 100%;
  height: auto;
  display: block;
  object-fit: cover;
}

#section-{{ section.id }} .placeholder-svg {
  background: #2a2a2a;
  height: 600px;
  width: 100%;
}

/* Text Styles */
#section-{{ section.id }} .scroll-text {
  text-align: right;
  margin-right: 40px;
  flex: 1;
}

#section-{{ section.id }} .scroll-line {
  font-family: 'Neue Montreal', sans-serif; /* Ensure font is loaded */
  font-weight: 400;
  font-size: 48px;
  line-height: 130%;
  letter-spacing: 0.04em;
  text-align: right;
  vertical-align: middle;
  text-transform: capitalize;
  color: {{ section.settings.text_color }};
  margin: 0;
  opacity: 0.3;
  transition: opacity 0.3s ease, color 0.3s ease;
}

/* Focused State (Active Line) */
#section-{{ section.id }} .scroll-line.stwi-focused {
  opacity: 1;
  color: {{ section.settings.focus_color }};
}

/* Button Styles */
#section-{{ section.id }} .scroll-button {
  display: inline-block;
  margin-top: 64px;
  padding: 18px 89px;
  background-color: {{ section.settings.btn_bg }};
  font-family: 'Neue Montreal', sans-serif;
  font-weight: 500;
  font-size: 20px;
  line-height: 100%;
  letter-spacing: 0.04em;
  text-transform: capitalize;
  color: {{ section.settings.btn_text }};
  transition: opacity 0.3s;
  border-radius: 16px;
  text-decoration: none;
}

#section-{{ section.id }} .scroll-button:hover {
  opacity: 0.8;
}

/* Responsive: Laptop / Small Desktop */
@media (max-width: 1800px) {
  #section-{{ section.id }} .scroll-image-text-container {
    gap: 160px;
  }
  #section-{{ section.id }} .scroll-line {
    font-size: 43.2px;
  }
}

/* Responsive: Mobile */
@media (max-width: 767px) {
  #section-{{ section.id }}.scroll-image-text-section {
    padding: 0;
  }
  #section-{{ section.id }} .scroll-image-text-container {
    flex-direction: column;
    gap: 0;
  }
  
  /* Image on Mobile */
  #section-{{ section.id }} .scroll-image {
    width: 100%;
  }

  /* Text on Mobile */
  #section-{{ section.id }} .scroll-text {
    text-align: center;
    margin-right: 0;
    padding: 48px 16px 64px 16px;
    width: 100%;
  }

  #section-{{ section.id }} .scroll-line {
    font-size: 24px;
    text-align: center;
    padding-bottom: 12px;
  }
  
  #section-{{ section.id }} .scroll-line:last-child {
    padding-bottom: 0;
  }

  #section-{{ section.id }} .scroll-button {
    margin-top: 32px;
    width: 100%;
    padding: 14px;
    text-align: center;
  }
}

/* Responsive: Large Screens */
@media (min-width: 2200px) {
  #section-{{ section.id }}.scroll-image-text-section {
    padding: 104px;
  }
  #section-{{ section.id }} .scroll-image {
    max-width: 946.4px;
    width: 100%;
  }
  #section-{{ section.id }} .scroll-text {
    margin-right: 52px;
  }
  #section-{{ section.id }} .scroll-line {
    font-size: 62.4px;
  }
  #section-{{ section.id }} .scroll-button {
    font-size: 26px;
  }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const section = document.querySelector("#section-{{ section.id }}");
  if(!section) return;

  const lines = section.querySelectorAll(".scroll-line");

  function updateLineFocus() {
    const centerY = window.innerHeight / 2;
    let closestIndex = 0;
    let minDistance = Infinity;

    lines.forEach((line, index) => {
      const rect = line.getBoundingClientRect();
      const lineCenter = rect.top + rect.height / 2;
      const distance = Math.abs(centerY - lineCenter);

      if (distance < minDistance) {
        minDistance = distance;
        closestIndex = index;
      }
    });

    lines.forEach((line, index) => {
      if (index === closestIndex) {
        line.classList.add("stwi-focused");
      } else {
        line.classList.remove("stwi-focused");
      }
    });
  }

  updateLineFocus();
  window.addEventListener("scroll", updateLineFocus, { passive: true });
  window.addEventListener("resize", updateLineFocus, { passive: true });
  
  // Re-run for Shopify Editor updates
  document.addEventListener("shopify:section:load", updateLineFocus);
});
</script>