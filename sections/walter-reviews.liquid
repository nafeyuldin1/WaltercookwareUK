{% comment %}
  Section: Reviews Slider Custom (FINAL FIX - No Left Cut)
  - Fix: Removed negative margins on mobile to stop cutting.
  - Mobile: Padding-left added to container.
{% endcomment %}

{%- style -%}
  #shopify-section-{{ section.id }} .reviews-slider-section {
    background: {{ section.settings.bg_color }};
    padding-top: {{ section.settings.pt_d }}px;
    padding-bottom: {{ section.settings.pb_d }}px;
    overflow: hidden;
  }

  #shopify-section-{{ section.id }} .reviews-header {
    max-width: {{ section.settings.max_width }}px;
    margin: 0 auto;
    padding-right: 16px;
    {% if section.settings.center_heading %}text-align: center;{% endif %}
  }

  /* Heading */
  #shopify-section-{{ section.id }} .reviews-header h2 {
    color: {{ section.settings.heading_color }};
    font-size: {{ section.settings.heading_size_d }}px;
    line-height: 1.3;
    text-transform: capitalize;
    margin-top: 0;
    margin-bottom: 40px;
    font-weight: 400;
  }

  /* Header Layout */
  #shopify-section-{{ section.id }} .tabs-and-arrows {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
    flex-wrap: wrap;
    gap: 20px;
  }

  /* Tabs */
  #shopify-section-{{ section.id }} .review-tabs {
    display: flex;
    gap: 0;
    flex: 1; 
  }

  #shopify-section-{{ section.id }} .review-tabs .tab {
    padding: 12px 24px;
    background: {{ section.settings.bg_color }};
    color: {{ section.settings.tab_text_inactive }};
    border: 1.5px solid {{ section.settings.border_color }};
    flex: 1;
    font-size: 20px;
    font-weight: 500;
    line-height: 1.4;
    text-align: center;
    text-transform: capitalize;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  #shopify-section-{{ section.id }} .review-tabs .tab:first-child { border-radius: 12px 0 0 12px; }
  #shopify-section-{{ section.id }} .review-tabs .tab:last-child { border-radius: 0 12px 12px 0; border-left: 0; }
  
  #shopify-section-{{ section.id }} .review-tabs .tab.active {
    background: {{ section.settings.tab_bg_active }};
    color: {{ section.settings.tab_text_active }};
    border-color: {{ section.settings.tab_bg_active }};
  }

  /* Arrows */
  #shopify-section-{{ section.id }} .arrows button {
    background: transparent;
    padding: 0;
    border: none;
    cursor: pointer;
    height: 50px;
    width: 50px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.3s;
  }
  #shopify-section-{{ section.id }} .arrows button:hover { opacity: 0.8; }

  #shopify-section-{{ section.id }} .prev-arrow rect { stroke: {{ section.settings.arrow_border }}; fill: transparent; }
  #shopify-section-{{ section.id }} .prev-arrow path { stroke: {{ section.settings.arrow_icon }}; }
  
  #shopify-section-{{ section.id }} .next-arrow rect { fill: {{ section.settings.arrow_bg_active }}; stroke: none; }
  #shopify-section-{{ section.id }} .next-arrow path { stroke: {{ section.settings.arrow_icon_active }}; }

  #shopify-section-{{ section.id }} .arrows.desktop-arrows { display: flex; gap: 12px; }
  #shopify-section-{{ section.id }} .arrows.mobile-arrows { display: none; margin-top: 32px; justify-content: center; gap: 16px; }

  /* Slider Container Default */
  #shopify-section-{{ section.id }} .reviews-slider {
    max-width: {{ section.settings.max_width }}px;
    margin: 0 auto;
  }

  /* Review Card General */
  #shopify-section-{{ section.id }} .review-slide {
    background: {{ section.settings.card_bg }};
    color: {{ section.settings.card_text }};
    border-radius: 16px;
    padding: 24px;
    box-sizing: border-box;
    display: flex !important;
    flex-direction: column;
    height: auto;
    min-height: 240px; 
  }

  #shopify-section-{{ section.id }} .review-slide-top-wrapper { display: flex; gap: 12px; align-items: center; }
  #shopify-section-{{ section.id }} .review-avatar { width: 48px; height: 48px; border-radius: 8px; overflow: hidden; flex-shrink: 0; }
  #shopify-section-{{ section.id }} .review-avatar img { width: 100%; height: 100%; object-fit: cover; }
  
  #shopify-section-{{ section.id }} .review-name {
    font-size: 14px;
    font-weight: 600;
    color: {{ section.settings.name_color }};
    margin: 0 0 4px 0;
  }
  
  #shopify-section-{{ section.id }} .review-stars { display: flex; gap: 4px; }
  #shopify-section-{{ section.id }} .review-stars svg path { fill: {{ section.settings.star_color }}; }

  #shopify-section-{{ section.id }} .ctm-review-text {
    font-size: 15px;
    line-height: 1.5;
    color: {{ section.settings.card_text }};
    margin-top: 16px;
    margin-bottom: 0;
  }

  /* --- DESKTOP SPECIFIC (Keep Negative Margins Here Only) --- */
  @media (min-width: 1000px) {
    #shopify-section-{{ section.id }} .slick-list { margin: 0 -{{ section.settings.card_gap }}px; }
    #shopify-section-{{ section.id }} .slick-slide { margin: 0 {{ section.settings.card_gap }}px; }
    
    @media (min-width: 1800px) {
       #shopify-section-{{ section.id }} .reviews-slider { margin-left: auto; margin-right: auto; }
    }
  }

  /* --- MOBILE SPECIFIC (The Critical Fix) --- */
  @media (max-width: 999px) {
    #shopify-section-{{ section.id }} .reviews-slider-section {
      padding-top: {{ section.settings.pt_m }}px;
      padding-bottom: {{ section.settings.pb_m }}px;
    }
    
    #shopify-section-{{ section.id }} .reviews-header { padding: 0 16px; }
    #shopify-section-{{ section.id }} .reviews-header h2 { 
      font-size: {{ section.settings.heading_size_m }}px; 
      text-align: center; 
      margin-bottom: 30px;
    }
    
    #shopify-section-{{ section.id }} .tabs-and-arrows { justify-content: center; }
    #shopify-section-{{ section.id }} .arrows.desktop-arrows { display: none; }
    #shopify-section-{{ section.id }} .arrows.mobile-arrows { display: flex; }
    
    /* Mobile Tabs */
    #shopify-section-{{ section.id }} .review-tabs { flex-wrap: wrap; }
    #shopify-section-{{ section.id }} .review-tabs .tab { 
      font-size: 14px; width: 50%; flex: auto; border-radius: 0; 
      border: 1.5px solid {{ section.settings.border_color }};
    }
    #shopify-section-{{ section.id }} .review-tabs .tab:nth-child(odd) { border-right: 0; }
    #shopify-section-{{ section.id }} .review-tabs .tab:nth-child(1) { border-radius: 12px 0 0 0; }
    #shopify-section-{{ section.id }} .review-tabs .tab:nth-child(2) { border-radius: 0 12px 0 0; border-left: 1.5px solid {{ section.settings.border_color }}; border-right: 1.5px solid {{ section.settings.border_color }}; }
    #shopify-section-{{ section.id }} .review-tabs .tab:nth-child(3) { border-radius: 0 0 0 12px; border-top: 0; }
    #shopify-section-{{ section.id }} .review-tabs .tab:nth-child(4) { border-radius: 0 0 12px 0; border-top: 0; border-left: 1.5px solid {{ section.settings.border_color }}; border-right: 1.5px solid {{ section.settings.border_color }}; }

    /* --- FIX START --- */
    /* 1. Container ko padding do taake content left edge se chipke nahi */
    #shopify-section-{{ section.id }} .reviews-slider { 
      padding-left: 20px; 
      padding-right: 0;
      width: 100%;
      display: block;
    }

    /* 2. Slick List ka default margin 0 karo taake wo left par cut na ho */
    #shopify-section-{{ section.id }} .slick-list { 
      margin: 0 !important; 
      padding: 0 !important;
      overflow: visible !important; /* Allow shadow/content to breathe */
    }

    /* 3. Slide ko sirf right margin do (gap ke liye), Left margin 0 */
    #shopify-section-{{ section.id }} .slick-slide {
      margin-left: 0 !important;
      margin-right: 16px !important;
    }
    /* --- FIX END --- */
  }
{%- endstyle -%}

<div class="reviews-slider-section" id="reviews-section-{{ section.id }}">
  <div id="walter_reviews" class="reviews-header">
    {%- if section.settings.heading != blank -%}
      <h2>{{ section.settings.heading }}</h2>
    {%- endif -%}
    
    <div class="tabs-and-arrows">
      <div class="review-tabs">
        {%- for block in section.blocks -%}
          {%- if block.type == 'tab' -%}
            <button class="tab {% if forloop.first %}active{% endif %}" 
                    data-category="{{ block.settings.cat_id }}"
                    {{ block.shopify_attributes }}>
              {{ block.settings.title }}
            </button>
          {%- endif -%}
        {%- endfor -%}
      </div>

      <div class="arrows desktop-arrows">
        <button class="prev-arrow js-prev-{{ section.id }}" aria-label="Previous">
          <svg width="50" height="50" viewBox="0 0 50 50" fill="none">
            <rect x="1" y="1" width="48" height="48" rx="12" stroke-width="1.5"></rect>
            <path d="M27.5 20L22.5 25L27.5 30" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"></path>
          </svg>
        </button>
        <button class="next-arrow js-next-{{ section.id }}" aria-label="Next">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
            <rect width="48" height="48" rx="12"></rect>
            <path d="M21.5 19L26.5 24L21.5 29" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div class="reviews-slider js-reviews-slider-{{ section.id }}" 
       data-desktop="{{ section.settings.slides_desktop }}" 
       data-mobile="{{ section.settings.slides_mobile }}">
    {%- for block in section.blocks -%}
      {%- if block.type == 'review' -%}
        <div class="review-slide" data-category="{{ block.settings.cat_id }}" {{ block.shopify_attributes }}>
          <div class="review-slide-top-wrapper">
            <div class="review-avatar">
              {%- if block.settings.image != blank -%}
                {{ block.settings.image | image_url: width: 100 | image_tag: loading: 'lazy' }}
              {%- else -%}
                {{ 'image' | placeholder_svg_tag }}
              {%- endif -%}
            </div>
            <div class="review-slide-top-content">
              <p class="review-name">{{ block.settings.name }}</p>
              <div class="review-stars">
                {%- for i in (1..5) -%}
                  <svg xmlns="http://www.w3.org/2000/svg" width="15" height="14" viewBox="0 0 15 14">
                    <path d="M9.96647 8.50197L12.5407 6.00355L8.99056 5.48205L7.40039 2.26789L5.81022 5.48205L2.26006 6.00355L4.83372 8.50197L4.21947 12.044L7.40039 10.3698L10.5726 12.044L9.96647 8.50197Z" fill="currentColor"/>
                    <path d="M14.4004 5.49838C14.4004 5.62205 14.3275 5.7568 14.1816 5.90264L11.1273 8.88055L11.8506 13.0876C11.8594 13.1832 11.8594 13.2561 11.8594 13.2561C11.8594 13.5361 11.7445 13.6761 11.5146 13.6761C11.4079 13.6761 11.2959 13.6429 11.1781 13.5758L7.40039 11.5896L3.62272 13.5752C3.49906 13.6423 3.38706 13.6761 3.28614 13.6761C3.16831 13.6761 3.08022 13.6353 3.02131 13.5536C2.96055 13.4664 2.92947 13.3618 2.93264 13.2556L3.67347 8.88055L0.610974 5.90205C0.470391 5.75097 0.400391 5.6168 0.400391 5.49838C0.400391 5.2913 0.557891 5.1618 0.871724 5.11164L5.09506 4.49739L6.98797 0.669552C7.09472 0.439135 7.23181 0.324219 7.40039 0.324219C7.56897 0.324219 7.70606 0.439135 7.81281 0.669552L9.70572 4.49739L13.9291 5.11164C14.2435 5.1618 14.4004 5.2913 14.4004 5.49838Z" fill="currentColor"/>
                  </svg>
                {%- endfor -%}
              </div>
            </div>
          </div>
          <p class="ctm-review-text">“{{ block.settings.text }}”</p>
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>

  <div class="arrows mobile-arrows">
    <button class="prev-arrow js-prev-{{ section.id }}">
      <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50" fill="none">
        <rect x="1" y="1" width="48" height="48" rx="12" stroke-width="1.5"></rect>
        <path d="M27.5 20L22.5 25L27.5 30" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"></path>
      </svg>
    </button>
    <button class="next-arrow js-next-{{ section.id }}">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
        <rect width="48" height="48" rx="12"></rect>
        <path d="M21.5 19L26.5 24L21.5 29" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"></path>
      </svg>
    </button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  var $ = window.jQuery;
  if (!$ || !$.fn || !$.fn.slick) return;

  var SECTION_ID = "{{ section.id }}";
  var $container = $('#reviews-section-' + SECTION_ID);
  var $slider    = $container.find('.js-reviews-slider-' + SECTION_ID);
  var $tabs      = $container.find('.review-tabs .tab');

  // Dynamic Settings
  var desktopSlides = parseFloat($slider.attr('data-desktop')) || 3;
  var mobileSlides  = parseFloat($slider.attr('data-mobile')) || 1.2;

  function initSlick() {
    $slider.slick({
      infinite: false, /* Set to false for cleaner start position */
      slidesToShow: desktopSlides,
      slidesToScroll: 1,
      variableWidth: false, 
      arrows: false,
      dots: false,
      centerMode: false,
      responsive: [
        {
          breakpoint: 1024,
          settings: {
            slidesToShow: Math.min(desktopSlides, 3) 
          }
        },
        {
          breakpoint: 999,
          settings: {
            slidesToShow: mobileSlides, /* e.g. 1.2 for peek */
            variableWidth: false,
            centerMode: false, /* Force centerMode off */
            infinite: false /* Keep it false to prevent cloning issues at start */
          }
        }
      ]
    });
  }

  // Init Slider
  initSlick();

  // Bind Custom Arrows
  $container.find('.js-prev-' + SECTION_ID).on('click', function(){ $slider.slick('slickPrev'); });
  $container.find('.js-next-' + SECTION_ID).on('click', function(){ $slider.slick('slickNext'); });

  // Initial Filter (First Tab)
  var firstCat = $tabs.first().attr('data-category');
  if (firstCat) {
    $slider.slick('slickUnfilter');
    $slider.slick('slickFilter', function() {
      return $(this).attr('data-category') === firstCat;
    });
  }

  // Tab Filtering Logic
  $tabs.on("click", function () {
    var $this = $(this);
    var category = $this.attr("data-category");

    $tabs.removeClass("active");
    $this.addClass("active");

    $slider.slick('slickUnfilter');
    
    if (category) {
      $slider.slick('slickFilter', function () {
        return $(this).attr('data-category') === category;
      });
      $slider.slick('slickGoTo', 0, true);
    }
  });

  // Theme Editor Re-init
  document.addEventListener('shopify:section:load', function(e){
    if(e.detail.sectionId === SECTION_ID) {
      $slider.slick('setPosition');
    }
  });
});
</script>

{% schema %}
{
  "name": "Reviews Slider Custom",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "5,000+ 5-Star Reviews"
    },
    {
      "type": "checkbox",
      "id": "center_heading",
      "label": "Center Align Heading",
      "default": false
    },
    {
      "type": "header",
      "content": "Slide Count Settings"
    },
    {
      "type": "range",
      "id": "slides_desktop",
      "min": 1,
      "max": 4,
      "step": 1,
      "label": "Cards to show (Desktop)",
      "default": 3
    },
    {
      "type": "range",
      "id": "slides_mobile",
      "min": 1,
      "max": 3,
      "step": 0.1,
      "label": "Cards to show (Mobile)",
      "default": 1.2,
      "info": "Use decimal (e.g. 1.2) to make next slide visible."
    },
    {
      "type": "range",
      "id": "card_gap",
      "min": 0,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Gap Between Cards",
      "default": 16
    },
    {
      "type": "header",
      "content": "Global Colors"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#BCA588"
    },
    {
      "type": "header",
      "content": "Tab Style"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color",
      "default": "#454545"
    },
    {
      "type": "color",
      "id": "tab_text_inactive",
      "label": "Inactive Tab Text",
      "default": "#B0B0B0"
    },
    {
      "type": "color",
      "id": "tab_bg_active",
      "label": "Active Tab Background",
      "default": "#A3835F"
    },
    {
      "type": "color",
      "id": "tab_text_active",
      "label": "Active Tab Text",
      "default": "#121212"
    },
    {
      "type": "header",
      "content": "Arrow Style"
    },
    {
      "type": "color",
      "id": "arrow_border",
      "label": "Border (Inactive)",
      "default": "#454545"
    },
    {
      "type": "color",
      "id": "arrow_icon",
      "label": "Icon (Inactive)",
      "default": "#454545"
    },
    {
      "type": "color",
      "id": "arrow_bg_active",
      "label": "Background (Active)",
      "default": "#A3835F"
    },
    {
      "type": "color",
      "id": "arrow_icon_active",
      "label": "Icon (Active)",
      "default": "#121212"
    },
    {
      "type": "header",
      "content": "Card Style"
    },
    {
      "type": "color",
      "id": "card_bg",
      "label": "Card Background",
      "default": "#F6F4F0"
    },
    {
      "type": "color",
      "id": "card_text",
      "label": "Review Text Color",
      "default": "#252525"
    },
    {
      "type": "color",
      "id": "name_color",
      "label": "Name Color",
      "default": "#2C1F1C"
    },
    {
      "type": "color",
      "id": "star_color",
      "label": "Star Color",
      "default": "#B57C46"
    },
    {
      "type": "header",
      "content": "Layout Spacing"
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 1000,
      "max": 2400,
      "step": 20,
      "label": "Max Width",
      "default": 1680
    },
    {
      "type": "range",
      "id": "heading_size_d",
      "min": 24,
      "max": 80,
      "step": 2,
      "label": "Heading Size (Desktop)",
      "default": 48
    },
    {
      "type": "range",
      "id": "heading_size_m",
      "min": 18,
      "max": 40,
      "step": 1,
      "label": "Heading Size (Mobile)",
      "default": 24
    },
    {
      "type": "range",
      "id": "pt_d",
      "min": 0,
      "max": 200,
      "step": 5,
      "label": "Top Padding (Desktop)",
      "default": 120
    },
    {
      "type": "range",
      "id": "pb_d",
      "min": 0,
      "max": 200,
      "step": 5,
      "label": "Bottom Padding (Desktop)",
      "default": 120
    },
    {
      "type": "range",
      "id": "pt_m",
      "min": 0,
      "max": 100,
      "step": 2,
      "label": "Top Padding (Mobile)",
      "default": 64
    },
    {
      "type": "range",
      "id": "pb_m",
      "min": 0,
      "max": 100,
      "step": 2,
      "label": "Bottom Padding (Mobile)",
      "default": 64
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Category Tab",
      "limit": 4,
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Tab Name",
          "default": "Wellness"
        },
        {
          "type": "text",
          "id": "cat_id",
          "label": "Category ID",
          "default": "cat1",
          "info": "Match this with the ID in Review Cards."
        }
      ]
    },
    {
      "type": "review",
      "name": "Review Card",
      "settings": [
        {
          "type": "text",
          "id": "cat_id",
          "label": "Category ID",
          "default": "cat1",
          "info": "Must match a Tab ID."
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "User Avatar"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Name & Date",
          "default": "John Doe, Jan 2025"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Review Content",
          "default": "This product is amazing!"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Reviews Slider Custom",
      "blocks": [
        { "type": "tab", "settings": { "title": "Wellness", "cat_id": "wellness" } },
        { "type": "tab", "settings": { "title": "Chefs", "cat_id": "chefs" } },
        { "type": "review", "settings": { "cat_id": "wellness", "name": "Sarah", "text": "Great for my health." } },
        { "type": "review", "settings": { "cat_id": "wellness", "name": "Mike", "text": "Love the titanium." } },
        { "type": "review", "settings": { "cat_id": "chefs", "name": "Chef Ramsey", "text": "Perfect precision." } }
      ]
    }
  ]
}
{% endschema %}